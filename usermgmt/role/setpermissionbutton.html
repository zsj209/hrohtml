<style></style><script type="text/javascript">	function getRoleTreeButton(roleId){		var params = {			_mt : "node.getnodetree",			roleId : roleId		};		var payload = {			data : params,			level : "UserLogin"		};		var data = encrypt(payload.level, payload.data);		console.log(data._sig + "--data");		//comAlert("aaa");		$.ajax({			type : "POST",			url : pubsources.pub_getlink,			dataType : "json",			xhrFields : {				withCredentials : true			},			data : serialize(data),			success : function(result) {				if (getStatus(result)) {					var citylist = result.content["0"].value, sb = [], sbs = [];					sb.push("<ul id=\"button_jqCTree\" class=\"jqCTree\">");					$.each(citylist,function(){						sbs.push(String.format("<li class=\"%s\">", this.setstyle));						sbs.push(String.format("<input type=\"checkbox\" name=\"checkName\" id=\"%s\" pnode=\"%s\" node=\"%s\">", this.nodeId, this.nodePcode, this.nodeCode));						if (this.sublist.length > 0 && this.parentId == 0) {							sbs.push(String.format("<label>%s</label>", this.nodeName));						}else{							sbs.push(String.format("<label class=\"%s\" nodeId = \"%s\">%s</label>", "roleButton",this.nodeId,this.nodeName));						}						if (this.sublist.length > 0) {							sbs.push(String.format("<ul>%s</ul>", this.sublist));						}						sbs.push("</li>");						var tmpcode = "["+this.nodeId+"]", tmpsb = sb.join("");						if (tmpsb.indexOf(tmpcode)>-1) {							var tmps = tmpsb.replace(tmpcode, sbs.join(""));							sb = [];							sb.push(tmps);						} else {							sb.push(sbs.join(""));						}						sbs = [];					});					sb.push("</ul>");					$("#nodepermis_tree_button").html(sb.join(""));					var t = $("#button_jqCTree").jqCTree({});					t.oneExpand();						//只显示选中的节点（预览）					$("#selall").attr("disabled","disabled");	 				$("#reset").attr("disabled","disabled");	 				$("#continue").attr("disabled","");	 				t.preview();			 			//清除点击事件		 			$("#button_jqCTree").find(".checkbox").unbind("click");		 			$("#button_jqCTree").find("label").unbind("click");		 					 					 					 					 			$(".roleButton").bind('click',function(){		 				var nodeId = $(this).attr("nodeid")		 				//comAlert(nodeId);		 				$("#permiss_nodeId").val(nodeId);						//根据roleId ,nodeId查询buttonId						//comAlert($(this).attr("nodeid"));						 var par =  {							 _mt:"button.getbuttonbynodeid",							 nodeId: nodeId						}						getRoleNodeButton(par,"UserLogin");								 			})		 								}  else if (result.stat.stateList["0"].code=="1040") {					$("#nodepermis_tree_button").html("请先分配节");				} else if (result.stat.stateList["0"].code=="3019") {					$("#nodepermis_tree_button").html("系统错误，请与系统管理员联系！");				} 			},		 	error : function() {				$("#nodepermis_tree").val("抱歉，网络故障或服务器繁忙，请检查您的网络环境或稍后重试。");			}		});	};		function getRoleNodeButton(requestData, level) {		var payload = {			data : requestData,			level : level		};		data = encrypt(payload.level, payload.data);		console.log(data);		$.ajax({			type : "POST",			url : pubsources.pub_getlink,			crossDomain : true,			dataType : "json",			xhrFields : {				withCredentials : true			},			data : serialize(data),			success : function(result) {				//TODO 根据条件刷新				if (com_error(result)) {					console.log(result);					//添加复选框					var buttonValue = result.content["0"].value;					console.log(buttonValue);					_arr = [];					var i=0;					for ( var o in buttonValue) {						_arr.push("<input type='checkbox' style='width:16px; margin-left: 10px;' name='buttonId' value='"+buttonValue[o].id+"' style='vertical-align:middle;'/><lable style='vertical-align:middle;'>"							+ buttonValue[o].buttonName	+ "</lable>");						i++;						if ((i%4)==0){							_arr.push("<br/>");						}					}					if (_arr.length>0){						_arr.push("<div style=\"margin-left: 10px;margin-top:5px;\"><input type=\"button\" style=\"width:60px;\" id=\"saveRoleButton\" value=\"&nbsp;保存&nbsp;\"></div>");					}					//alert(_arr.join(""));					$("#nodebtnper_button").html(_arr.join(""));					$("#saveRoleButton").bind('click', SaveRoleButton);						//获取已经选中的按钮					var par = {						_mt : "rolebutton.getrolebutton",						roleId : $("#permiss_roleId").val(),						nodeId : requestData.nodeId					}					getSelectButton(par, "UserLogin");				} else if (result.stat.stateList["0"].code=="1041") {					//TODO					$("#nodepermis_tree_button").html("请先维护按钮基础信息");				}else {					alertMsg(result, "usermgmt_code_desc");				}			},			error : function() {				comAlert("抱歉，网络故障或服务器繁忙，请检查您的网络环境或稍后重试。");			}		});	};	function getSelectButton(requestData, level) {		var payload = {			data : requestData,			level : level		};		data = encrypt(payload.level, payload.data);		console.log(data);		$.ajax({			type : "POST",			url : pubsources.pub_getlink,			crossDomain : true,			dataType : "json",			xhrFields : {				withCredentials : true			},			data : serialize(data),			success : function(result) {				//TODO 根据条件刷新				if (com_error(result)) {					var value = result.content["0"].value;					console.log(result);					$('#nodebtnper_button').find('input').each(function() {						for ( var o in value) {							//alert(value[o].buttonId);							if ($(this).val() == value[o].buttonId) {								$(this).prop("checked", true);								break;							}						}					})				} else {					alertMsg(result, "usermgmt_code_desc");				}			},			error : function() {				comAlert("抱歉，网络故障或服务器繁忙，请检查您的网络环境或稍后重试。");			}		});	}	//保存	function addRoleButton(requestData, level) {		var payload = {			data : requestData,			level : level		};		data = encrypt(payload.level, payload.data);		console.log(data);		$.ajax({			type : "POST",			url : pubsources.pub_getlink,			crossDomain : true,			dataType : "json",			xhrFields : {				withCredentials : true			},			data : serialize(data),			success : function(result) {				if (com_error(result)) {					comAlert(pubprompt.save_succ);				} else {					alertMsg(result, "usermgmt_code_desc");				}			},			error : function() {				comAlert("抱歉，网络故障或服务器繁忙，请检查您的网络环境或稍后重试。");			}		});	}	function SaveRoleButton() {		//获取所有选中的复选框的值		var adIds = new Array();		$("#nodebtnper_button").find("input:checkbox[name=buttonId]:checked'")				.each(function(i) {					adIds.push($(this).val());				});		var par = {			_mt : "rolebutton.addORmodifyrolenodebutton",			roleId : $("#permiss_roleId").val(),			nodeId : $("#permiss_nodeId").val(),			data : adIds.toString()		}		addRoleButton(par, "UserLogin");	}</script><div>	<div style="width: 98%; height: 485px;" class="border_test">		<div>			<span>请选择已授权的节点</span><span style="margin-left:295px;">设置按钮权限</span>		</div>		<div id="nodepermis_tree_button" style="width: 400px; height: 100%; float: left;" class="ui-jqCTree-form"></div>		<div style="width: 400px; height: 100%; float: left; margin-left:10px;" class="ui-jqCTree-form">			<div id="nodebtnper_button" style="margin-top:5px;"></div>		</div>	</div></div>